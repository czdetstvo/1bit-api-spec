Версия от 28.11.2024.

**ОГЛАВЛЕНИЕ**

[Соглашение о типах данных 2](#_Toc11581)

[Адрес сервиса при публикации базы 1С на веб-сервере 2](#_Toc15973)

[Схема обмена для онлайн-записи 4](#_Toc27016)

[1. HTTP-сервисы веб-интеграции 5](#_Toc22136)

[1.1. Schedule (Графики расписания) 6](#_Toc26123)

[1.2. AppointmentCreate (Создание заявки или листа ожидания) 13](#_Toc4057)

[1.3. AppointmentStatus (Получение статуса заявки) 20](#_Toc13773)

[1.4. AppointmentCancel (Отменить заявку) 21](#_Toc4873)

[1.5. DictionaryData (Получение данных из базы) 22](#_Toc8823)

[1.6. Reservation (Создание брони) 27](#_Toc378)

[2. Веб-сервисы 1С 30](#_Toc29818)

[2.1. GetEnlargementSchedule (укрупненное расписание) 30](#_Toc914)

[2.2. GetSchedule (детальное расписание) 31](#_Toc5491)

[2.3. GetSchedule20 (детальное расписание) 33](#_Toc31744)

[2.4. GetReserve (бронь времени на оформление записи с сайта) 39](#_Toc9913)

[2.5. BookAnAppointment (запись с сайта) 40](#_Toc12959)

[2.6. BookAnAppointmentWithParams (запись с сайта) 41](#_Toc13614)

[2.7. GetAppointmentStatus (статус записи) 43](#_Toc7024)

[2.8. CancelBookAnAppointment (отмена записи) 44](#_Toc15565)

[2.9. FastBookAnAppointment (создать лист ожидания) 45](#_Toc17018)

[2.10. GetListEmployees (список сотрудников) 46](#_Toc404)

[2.11. GetListClinic (список филиалов) 48](#_Toc27536)

[2.12. GetNomenclatureAndPrices (прайс-лист) 49](#_Toc12464)

[3. FTP 52](#_Toc11589)

[3.1. Выгрузка номенклатуры и цен 52](#_Toc5144)

[3.2. Чтение листов ожидания 52](#_Toc18590)

[4. HTTP-сервисы дополнительные 54](#_Toc13307)

[4.1. CreateLead (Создание лида) 54](#_Toc19269)

# Соглашение о типах данных

Для указания времени или даты используется тип **dateTime**.

Формат типа dateTime для веб-сервисов, FTP и HTTP-сервиса CreateLead выглядит как «гггг-мм-ддTчч:мм:сс», где

Для времени без даты, используется шаблон: «0001-01-01Tчч:мм:сс».

Для даты без времени, используется шаблон: «гггг-мм-ддT00:00:00».

В остальных случаях допускаются следующие шаблоны для дат:

«гггг.мм.дд чч:мм:сс» или «дд.мм.гггг чч:мм:сс»

«гггг-мм-дд чч:мм:сс» или «дд-мм-гггг чч:мм:сс»

«гггг/мм/дд чч:мм:сс» или «дд/мм/гггг чч:мм:сс»

«гггг-мм-ддTчч:мм:сс» или «дд-мм-ггггTчч:мм:сс»

Если ожидается время без даты или наоборот - то ненужная часть будет игнорироваться, даже если указана. Дату или время тоже можно указывать отдельно друг от друга. К примеру, время можно указать как «чч:мм:сс».

# Адрес сервиса при публикации базы 1С на веб-сервере

База 1С публикуется штатными средствами платформы «1С:Предприятие 8.3» по документации от фирмы «1С» для администратора базы.

**Полный адрес публикации HTTP-сервиса имеет вид:**

http://192.168.0.2:8081/BASE\_NAME/hs/ROOT\_URL/PATTERN\_URL, где

**192.168.0.2:8081** – IP адрес веб-сервера, на котором опубликована база 1С.
Если используется не порт по умолчанию, указывается порт сервера.
Если обращение идёт из локальной сети – используется внутренний адрес сервера.
Если обращение идёт через Интернет – используется внешний «белый» IP сервера.

**BASE\_NAME** – Имя, под которым база опубликована на веб-сервере (определяется в момент публикации из Конфигуратора или позже в vrd-файле согласно правилам веб-сервера).

**hs** – Указатель на то, что обращение идёт к HTTP-сервису.

**ROOT\_URL** – Корневой URL, идентифицирующий HTTP-сервис в информационной базе. Можно изменить при публикации в Конфигураторе или после в vrd-файле публикации.

**PATTERN\_URL** – Шаблон URL, адрес обрабатываемый сервисом. Может содержать обязательные параметры и выглядеть как «`/URL\_NAME/{PARAM\_1}… /{PARAM\_N}`», где URL\_NAME - это имя шаблона, может быть пустым, PARAM\_1 ... PARAM\_N - это обязательные параметры.

*Например, адреса публикации для базы с именем публикации «MyBase» (корневой URL и шаблон URL заданы по умолчанию):*

|  |
| --- |
| Для операции Schelude - получения расписания у HTTP-сервиса обмена с сайтом:  http://192.168.0.2:8081/MyBase/hs/bwi/Schedule |
| Для операции AppointmentCreate - создания заявки или листа ожидания HTTP-сервиса обмена с сайтом:  http://192.168.0.2:8081/MyBase/hs/bwi/AppointmentCreate |
| Для HTTP-сервиса по созданию Лида:  http://192.168.0.2:8081/MyBase/hs/crm/createlead |

**Для веб-сервиса полный адрес публикации имеет вид:**

[http://192.168.0.2:8081/BASE_NAME/ws/ws1.1cws?wsdl], где

**192.168.0.2:8081** – IP адрес, аналогично с публикации HTTP-сервиса.

**BASE\_NAME** – Имя, аналогично с публикации HTTP-сервиса

**ws** – Указатель на то, что обращение идёт к веб-сервису.

**ws1.1cws** – Имя веб-сервиса, к которому идёт обращение. По умолчанию веб-сервис «integration» публикуется с именем ws1.1cws. Можно изменить при публикации в Конфигураторе или после в vrd-файле публикации.

Таким образом, тестировать отдельные методы публикации можно через спец. сервисы и плагины браузеров при условии строго-правильного указания параметров методов.

# Схема обмена для онлайн-записи

HTTP- и веб-сервисы обмена с сайтом позволяют записываться с сайта в актуальное расписание врача, а также получать листы ожидания.

Лист ожидание – это более простой вариант, чтобы сообщить в клинику о желании пациента связаться (в широком смысле это всегда заказ звонка с сайта, хотя на сайте может без несколько диалогов, импортируемых в 1С). Для листов ожидания достаточен веб-метод [FastBookAnAppointment](#_FastBookAnAppointment_(создать_лист).

Онлайн-запись – это операция, по итогу которой в реальном расписании сотрудника клиент занимает свободное время своей записью. В базе 1С о приходе записи с сайта пользователь узнаёт в окне расписания по появившейся гиперссылке «Новых внешних заявок:», через которую он переходит и проверяет их.

Порядок записи для клиента следующий:

1. На сайте посетитель выбирает врача, дату, время (обычно, несколько последовательных страниц);
2. Сайт бронирует это время в расписании клиники ([GetReserve](#_Reservation (Создание брони)));
3. Сайт переводит посетителя на форму, где он заносит контактные данные, комментарий (не дольше 15 минут после GetReserve);
4. Сайт отправляет данные в 1С, где бронь превращается в полноценную запись (К примеру, [BookAnAppointment](#_AppointmentCreate (Создание заявки или листа ожидания))).

*Альтернативная последовательность*: пользователь сначала вносит а форму сайта информацию для связи и комментарий, и только после этого выбирает врача, дату, свободное время, после чего сайт создаёт запись без предварительной брони времени в расписании (К примеру, [BookAnAppointment](#_AppointmentCreate (Создание заявки или листа ожидания))).

В обоих случаях свободное время надо знать *актуальное*. Для этого сайт должен оперативно спросить его у опубликованной на веб-сервере базы 1С на нужный интервал (К примеру, [GetSchedule](#_Schedule (Графики расписания))). Или неоперативно (прим. раз в день) сайт получает укрупненное расписание рабочего времени всех сотрудников без информации о том, занято ли оно уже (К примеру, [GetEnlargementSchedule](#_Schedule (Графики расписания))).

Остальные методы HTTP- и веб- сервисов второстепенны и могут не использоваться.

# HTTP-сервисы обмена с сайтом

Предназначены, прежде всего, для онлайн-записи с сайта.

Для каждого HTTP-сервиса указывается альтернативой каких [веб-сервисов](#_Веб-сервисы_1С) он является.

**Корневой URL (ROOT\_URL) по умолчанию:** bwi

Этот HTTP-сервис доступен начиная со следующих релизов:

1. БИТ.Управление медицинским центром – 2.0.49.54
2. БИТ.Управление медицинским центром КОРП – 2.1.25.38
3. БИТ.Стоматология – 2.0.29.18
4. БИТ.Айболит – 2.0.20.7
5. БИТ.Красота ПРОФ 8 – 2.0.27.1

Для работы HTTP-сервисов, в передаваемом теле запроса **требуется указание ключа API** конкретного элемента справочника «Настройки обмена с сайтом» как параметр «Key» в теле запроса. Обработка запроса будет использовать данные из выбранных настроек обмена с сайтом.

Для каждого реализованного HTTP-метода приводится таблица ожидаемых параметров из тела запроса. Если какое-то значение заполнено неправильно, запрос вернёт соответствующую ошибку.

Параметр «Method» указывает на то, какую модель поведения будет использовать обработка. Модель поведения представляет собой улучшенную работу одноимённого веб-сервиса.

Если в параметр, ожидающий уникальный идентификатор (УИД), надо передать несколько значений, то строка должна быть формата: «<Знач1>;<Знач2>…;<ЗначN>», где вместо угловых скобок указывается УИД. Если не ожидается больше одного УИД, то использоваться будет первое значение.

HTTP-сервис «ИнтеграцияССайтом» позволяет передавать собственные произвольные параметры при условии, что они не используют зарезервированные имена («НастройкиОбмена» и указанные в таблице к методу). Модифицировать обработку запроса можно при помощи расширения процедур общего модуля «ВебИнтеграцияПереопределяемый», где будут доступны все переданные параметры тела запроса. Если переданы параметры с именами отличными от зарезервированных, то эти значения будут формата строки или числа.

## Schedule (Графики расписания)

**Стандартный шаблон URL (PATTERN\_URL):** /Schedule

**HTTP-Метод POST**. Возвращает расписание сотрудников по параметрам. Подробнее в описании параметра Method [ниже](#_Описание_параметра_Method:_3).

Является аналогом следующих веб-сервисов: GetEnlargementSchedule, GetSchedule, GetSchedule20.

Параметры в теле запроса:

|  |  |  |  |
| --- | --- | --- | --- |
| **Имя** | **Обязательный** | **Тип значения** | **Описание** |
| Key | Да | string | Значение «Ключ API» для конкретной настройки обмена |
| Method | Нет | string | Имя модели поведения сервиса. Может быть: GetSchedule, GetSchedule20 **(по умолчанию)**, GetEnlargmenetSchedule |
| StartDate | Да | dateTime | **Дата** начала периода на который получается расписания. Если указано вместе с временем - время игнорируется |
| FinishDate | Да | dateTime | **Дата** окончания периода на который получается расписания. Если указано вместе с временем - время игнорируется |
| Clinic | Нет | string | УИД клиники расписания.  Игнорируется у GetSchedule |
| Employees | Нет | string | УИД или УИДы сотрудников по которым надо выводить расписание.  Игнорируется у GetSchedule |
| Format | Нет | string | Формат результата: JSON **(по умолчанию)**,  ZipXML (архив в виде строки BASE64 с xml), ZipJSON (архив в виде строки BASE64 с json). |
| OnlyFreeTime | Нет | boolean | Возвращать только свободное время врача  Игнорируется у GetEnlargmenetSchedule |

#### **Описание параметра Method:**

Параметр «Method» является необязательным параметром, если он не задан, то обработка будет аналогичной «GetSchedule20». Параметр «Method» определяет поведение обработки:

**GetEnlargmenetSchedule** – Получение расписания сотрудников без учёта перерывов и занятого заявками клиентов времени (укрупнённого). Применяется отбор настроек обмена с сайтом и переданные в теле запроса параметры клиники (Clinic) и искомых сотрудников (Employees).

**GetSchedule** – Получение расписания на всех сотрудников (игнорируя переданный параметр УИДов сотрудников), что попадают под отбор настроек обмена с сайтом за период с начала дня StartDate по конец дня FinishDate. Время возвращается с учётом перерывов и временем, занятым заявками клиентов.

**GetSchedule20** – Получение расписания на всех сотрудников, что попадают под отбор настроек обмена с сайтом и всех параметров из тела запроса. Время возвращается с учётом перерывов и временем, занятым заявками клиентов.

Метод может вернуть пустой результат, если в базе нет данных, удовлетворяющих одновременно настройки отбора из базы и переданные в теле запроса параметры.

#### **Примеры**:

1. **Получение укрупнённого расписания (GetEnlargmenetSchedule)**

Получим укрупнённое расписание для двух сотрудников. Только у одного на искомое время назначено рабочее время в графиках работы. В настройках обмена у нас нет ограничений. Требуемый формат данных: XML.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method": "GetEnlargmenetSchedule",*

*"StartDate": "14.10.2024 00:00:00",*

*"FinishDate": "15.10.2024 00:00:00",*

*"Clinic": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Employees": "e7005e6d-65c9-11e9-936d-1856809fe650; 6cf96534-3870-11e2-87ba-002618dcef2c",*

*"Format": "ZipXML"*

*}*

Возвращаемый результат:

Данные ответа:

*<?xml version="1.0"?>*

*<ГрафикиДляСайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">*

*<ГрафикДляСайта>*

*<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>*

*<СотрудникФИО>Красильникова Наталья Семеновна</СотрудникФИО>*

*<СотрудникID>e7005e6d-65c9-11e9-936d-1856809fe650</СотрудникID>*

*<Специализация>Дерматология и косметология</Специализация>*

*<ПериодыГрафика>*

*<СвободноеВремя>*

*<ПериодГрафика>*

*<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>*

*<Дата>2024-10-14T00:00:00</Дата>*

*<ВремяНачала>2024-10-14T09:00:00</ВремяНачала>*

*<ВремяОкончания>2024-10-14T20:00:00</ВремяОкончания>*

*<ВидВремени>624f2a40-5aa8-4f01-83f4-0f38535364bb</ВидВремени>*

*</ПериодГрафика>*

*<ПериодГрафика>*

*<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>*

*<Дата>2024-10-15T00:00:00</Дата>*

*<ВремяНачала>2024-10-15T09:00:00</ВремяНачала>*

*<ВремяОкончания>2024-10-15T20:00:00</ВремяОкончания>*

*<ВидВремени>624f2a40-5aa8-4f01-83f4-0f38535364bb</ВидВремени>*

*</ПериодГрафика>*

*</СвободноеВремя>*

*<ЗанятоеВремя/>*

*</ПериодыГрафика>*

*<ДлительностьПриема>0001-01-01T00:30:00</ДлительностьПриема>*

*</ГрафикДляСайта>*

*</ГрафикиДляСайта>*

1. **Получение расписания сотрудников на заданное время (GetSchedule)**

Получим расписание всех сотрудников на день с учётом заявок и перерывов. На выбранный день в базе расписание стоит у двух сотрудников, у одного из которых есть две заявки (Красильникова Н.С.).

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method": "GetSchedule",*

*"StartDate": "11.10.2024 00:00:00",*

*"FinishDate": "11.10.2024 00:00:00"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"ГрафикДляСайта": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"СотрудникФИО": "Иванова Ксения Андреевна",*

*"СотрудникID": "ac30e139-3087-11dc-8594-005056c00008",*

*"Специализация": "Диагностика",*

*"ПериодыГрафика": {*

*"СвободноеВремя": {*

*"ПериодГрафика": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-11T00:00:00",*

*"ВремяНачала": "2024-10-11T09:00:00",*

*"ВремяОкончания": "2024-10-11T20:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*}*

*]*

*},*

*"ЗанятоеВремя": ""*

*},*

*"ДлительностьПриема": "0001-01-01T00:00:00"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"СотрудникФИО": "Красильникова Наталья Семеновна",*

*"СотрудникID": "e7005e6d-65c9-11e9-936d-1856809fe650",*

*"Специализация": "Дерматология и косметология",*

*"ПериодыГрафика": {*

*"СвободноеВремя": {*

*"ПериодГрафика": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-11T00:00:00",*

*"ВремяНачала": "2024-10-11T09:00:00",*

*"ВремяОкончания": "2024-10-11T09:30:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-11T00:00:00",*

*"ВремяНачала": "2024-10-11T10:30:00",*

*"ВремяОкончания": "2024-10-11T13:30:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-11T00:00:00",*

*"ВремяНачала": "2024-10-11T16:30:00",*

*"ВремяОкончания": "2024-10-11T20:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*}*

*]*

*},*

*"ЗанятоеВремя": {*

*"ПериодГрафика": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-11T00:00:00",*

*"ВремяНачала": "2024-10-11T09:30:00",*

*"ВремяОкончания": "2024-10-11T10:30:00",*

*"ВидВремени": ""*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-11T00:00:00",*

*"ВремяНачала": "2024-10-11T13:30:00",*

*"ВремяОкончания": "2024-10-11T16:30:00",*

*"ВидВремени": ""*

*}*

*]*

*}*

*},*

*"ДлительностьПриема": "0001-01-01T00:30:00"*

*}*

*]*

*}*

*}*

1. **Получение расписания с параметрами (GetSchedule20)**

Получим расписание свободного времени на два дня для двух сотрудников в центральной клинике (у одного из сотрудников на один день назначена заявка).

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method": "GetSchedule20",*

*"StartDate": "17.10.2024 00:00:00",*

*"FinishDate": "18.10.2024 00:00:00",*

*"Employees": "ac30e13a-3087-11dc-8594-005056c00008; e7005e6d-65c9-11e9-936d-1856809fe650",*

*"Clinic": "f679444a-22b7-11df-8618-002618dcef2c",*

*"OnlyFreeTime": true*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"ГрафикДляСайта": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"СотрудникФИО": "Барбышева Евгения Петровна",*

*"СотрудникID": "ac30e13a-3087-11dc-8594-005056c00008",*

*"Специализация": "Офтальмология",*

*"ПериодГрафика": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-17T00:00:00",*

*"ВремяНачала": "2024-10-17T09:00:00",*

*"ВремяОкончания": "2024-10-17T20:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-18T00:00:00",*

*"ВремяНачала": "2024-10-18T09:00:00",*

*"ВремяОкончания": "2024-10-18T20:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*}*

*],*

*"ДлительностьПриема": "0001-01-01T00:00:00"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"СотрудникФИО": "Красильникова Наталья Семеновна",*

*"СотрудникID": "e7005e6d-65c9-11e9-936d-1856809fe650",*

*"Специализация": "Дерматология и косметология",*

*"ПериодГрафика": [*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-17T00:00:00",*

*"ВремяНачала": "2024-10-17T09:00:00",*

*"ВремяОкончания": "2024-10-17T12:10:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-17T00:00:00",*

*"ВремяНачала": "2024-10-17T12:40:00",*

*"ВремяОкончания": "2024-10-17T20:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-18T00:00:00",*

*"ВремяНачала": "2024-10-18T09:00:00",*

*"ВремяОкончания": "2024-10-18T14:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*},*

*{*

*"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",*

*"Дата": "2024-10-18T00:00:00",*

*"ВремяНачала": "2024-10-18T14:30:00",*

*"ВремяОкончания": "2024-10-18T20:00:00",*

*"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"*

*}*

*],*

*"ДлительностьПриема": "0001-01-01T00:30:00"*

*}*

*]*

*}*

*}*

## AppointmentCreate (Создание заявки или листа ожидания)

**Стандартный шаблон URL (PATTERN\_URL):** /AppointmentCreate

**HTTP-Метод POST**. Создание или изменение в базе документа заявка или создание листа ожидания с переданными данными. Подробнее в описании параметра Method [ниже](#_Описание_параметра_Method:_4).

Является аналогом следующих веб-сервисов:
BookAnAppointment, BookAnAppointmentWithClient, FastBookAnAppointment, FastBookAnAppointmentWithClient , BookAnAppointmentWithParams.

Параметры в теле запроса:

|  |  |  |  |
| --- | --- | --- | --- |
| **Наименование** | **Обязательный** | **Тип значения** | **Описание** |
| Key | Да | string | Значение «Ключ API» для конкретной настройки обмена |
| Method | Да | string | Имя модели поведения сервиса. Может быть: BookAnAppointment, BookAnAppointmentWithClient, FastBookAnAppointment, FastBookAnAppointmentWithClient, BookAnAppointmentWithParams |
| Date | Да | dateTime | **Дата** на которую создаётся заявка/лист ожидания. Если указано вместе с временем - время игнорируется |
| TimeBegin | Да | dateTime | **Время** на которое создаётся заявка/лист ожидания. Если указано вместе с датой - дата игнорируется |
| Clinic | Да | string | УИД клиники расписания |
| EmployeeID | Да\* | string | УИД сотрудника к которому создаётся заявка  \* – Игнорируется FastBookAnAppointment и FastBookAnAppointmentWithClient |
| EquipmentCabinet | Нет | string | УИД оборудования, к которому оформляется заявка. Используется, когда нужно записать и сотрудника и кабинет/оборудования  Игнорируется FastBookAnAppointment и FastBookAnAppointmentWithClient |
| Client | Да\* | string | УИД клиента в базе для записи  \* – Обязательный для BookAnAppointmentWithClient и FastBookAnAppointmentWithClient |
| Service | Да\* | string | УИД или УИДы номенклатуры для записи  \* – Обязательный для метода BookAnAppointmentWithClient |
| GUID | Нет | string | УИД Заявки, которую надо изменить (вместо создания новой)  Игнорируется в FastBookAnAppointment и FastBookAnAppointmentWithClient |
| PatientSurname | Нет | string | Фамилия пациента  Игнорируется FastBookAnAppointmentWithClient и BookAnAppointmentWithClient |
| PatientName | Нет | string | Имя пациента  Игнорируется в FastBookAnAppointmentWithClient и BookAnAppointmentWithClient |
| PatientFatherName | Нет | string | Отчество пациента  Игнорируется в FastBookAnAppointmentWithClient и BookAnAppointmentWithClient |
| Comment | Нет | string | Комментарий к Заявке/Листу ожидания |
| Phone | Нет | string | Телефон пациента  Игнорируется в FastBookAnAppointmentWithClient и BookAnAppointmentWithClient |
| Email | Нет | string | Электронный адрес пациента  Игнорируется в FastBookAnAppointmentWithClient и BookAnAppointmentWithClient |
| Address | Нет | string | Адрес проживания пациента  Игнорируется в FastBookAnAppointmentWithClient и BookAnAppointmentWithClient |
| Specialization | Нет | string | Примечание о желаемой специализации в листе заявки.  Используется у FastBookAnAppointment |
| Birthday | Нет | dateTime | **Дата** рождения клиента. Если указано вместе с временем - время игнорируется  Используется у BookAnAppointmentWithParams |
| Duration | Нет | dateTime | Планируемая длительность заявки. Ожидается **время**. Если указано вместе с датой - дата игнорируется |
| DurationType | Нет | string | Способ расчёта длительности услуг заявки (Если параметр Duration пустой).  Может быть: «**ServiceDuration**» - Расчёт по стандартному времени услуг.  Если не указан или не тот, что описан выше, то предполагаемое время будет рассчитано из настроек стандартного приёма сотрудника и учётной политики |

#### **Описание параметра Method:**

Параметр «Method» обязателен. Если он не задан, то вернётся ошибка. Все варианты метода принимают как значение явное указание клиента (Client). Если клиент явно не указан, то некоторые методы могут его искать и создать, если клиент не был найден. Поиск осуществляется согласно настройкам обмена с сайтом, если они не указаны, то клиент будет создаваться каждый раз.

Все методы принимают параметр ожидаемой длительности (Duration), если он не был задан, то проверяется параметр DurationType, в котором можно явно указать вид поиска по номенклатуре. Если номенклатуры нет или параметр задан иначе, то расчёт времени проводится согласно стандартному приёму у сотрудника или настройкам учётной политики.

Методы работы с заявками (BookAnAppointment, BookAnAppointmentWithClient и BookAnAppointmentWithParams) являются схожими и различаются нагрузкой на систему. Аналогично и с методами по созданию листов ожидания (FastBookAnAppointment и FastBookAnAppointmentWithClient).

Параметр «Method» определяет поведение обработки:

**BookAnAppointment** – Создание или изменение Заявки (Изменение если был передан параметр GUID). Создаёт заявку на конкретного сотрудника. Может искать клиента, если тот явно не задан.

**BookAnAppointmentWithClient** – Создание или изменение Заявки (Изменение если был передан параметр GUID). Создаёт заявку на конкретного сотрудника. Требуется передавать перечень услуг для заявки.

**FastBookAnAppointment** – Создание Листа ожидания. Может искать клиента, если тот явно не задан. Позволяет указать желаемую специализацию.

**FastBookAnAppointmentWithClient** – Создание Листа ожидания. Позволяет передавать перечень услуг для листа ожидания.

**BookAnAppointmentWithParams** – Создание или изменение Заявки (Изменение если был передан параметр GUID). Создаёт заявку на конкретного сотрудника. Может искать клиента, если тот явно не задан. Позволяет передавать перечень услуг для заявки.

#### **Примеры**:

1. **Создание заявки (BookAnAppointment)**

Создадим заявку длительностью 40 минут. Укажем имя, фамилию и телефон клиента. Настройка обмена с сайтом задана так, что первый критерий поиска - это Фамилия и Имя, второй критерий - телефонный номер.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method":"BookAnAppointment",*

*"EmployeeID":"e7005e6d-65c9-11e9-936d-1856809fe650",*

*"Clinic":"f679444a-22b7-11df-8618-002618dcef2c",*

*"TimeBegin":"9:10:00",*

*"Date":"20.10.2024",*

*"PatientName":"Борис",*

*"PatientSurname":"Бубаков",*

*"Phone":"8-800-555-35-35",*

*"Duration":"0:40:00"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "true",*

*"ОписаниеОшибки": "",*

*"УИД": "55b17f33-8abe-11ef-9542-08979885f491"*

*}*

*}*

1. **Изменение заявки (BookAnAppointmentWithClient )**

Изменим созданную ранее заявку - передадим в качестве параметра GUID, что был возвращён в предыдущем примере. Добавим кабинет, перенесём время и добавим список услуг из двух элементов. При изменении заявки в теле ответа будет возвращён тот же самый УИД, что и был передан. В этом методе необходимо явно указать клиента.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method":"BookAnAppointmentWithClient",*

*"EmployeeID":"e7005e6d-65c9-11e9-936d-1856809fe650",*

*"Clinic":"f679444a-22b7-11df-8618-002618dcef2c",*

*"GUID":"55b17f33-8abe-11ef-9542-08979885f491",*

*"TimeBegin":"14:00:00",*

*"Date":"18.10.2024",*

*"Client":"92c7ea9d-2cab-11e4-9f84-1078d2d69bb4",*

*"EquipmentCabinet":"5210c9c3-65a2-11e9-936d-1856809fe650",*

*"Service":"222df5d1-4964-11e9-82be-40167e631f2e; 9fa37e64-4952-11e9-82be-40167e631f2e"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "true",*

*"ОписаниеОшибки": "",*

*"УИД": "55b17f33-8abe-11ef-9542-08979885f491"*

*}*

*}*

1. **Изменение заявки (BookAnAppointmentWithParams )**

Т.к. в прошлом примере не был указан DurationType, и Duration, то время посчиталось по стандартному времени указанного сотрудника. При изменении заявки, номенклатура и кабинет изменяются согласно переданным параметрам. Поэтому мы уберём из заявки кабинет, не указывая его в теле запроса. Пересчитаем время относительно переданных номенклатур и сменим клиента.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method":"BookAnAppointmentWithParams",*

*"EmployeeID":"e7005e6d-65c9-11e9-936d-1856809fe650",*

*"Clinic":"f679444a-22b7-11df-8618-002618dcef2c",*

*"GUID":"55b17f33-8abe-11ef-9542-08979885f491",*

*"TimeBegin":"14:00:00",*

*"Date":"18.10.2024",*

*"Service":"222df5d1-4964-11e9-82be-40167e631f2e; 9fa37e64-4952-11e9-82be-40167e631f2e",*

*"DurationType":"ServiceDuration",*

*"PatientName":"Борис",*

*"PatientSurname":"Бубаков",*

*"Phone":"8-800-555-35-35"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "true",*

*"ОписаниеОшибки": "",*

*"УИД": "55b17f33-8abe-11ef-9542-08979885f491"*

*}*

*}*

1. **Создание листа ожидания (FastBookAnAppointment )**

Создадим лист ожидания, укажем и желаемую специализацию и комментарий к листу ожидания. Укажем фамилию, имя и телефон клиента для поиска в базе, настройки обмена с сайтом остаются всё те же. Нам вернётся УИД документа Лист Ожидания, который был создан.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method":"FastBookAnAppointment",*

*"Clinic":"f679444a-22b7-11df-8618-002618dcef2c",*

*"TimeBegin":"14:00:00",*

*"Date":"18.10.2024",*

*"Specialization":"Необычная специализация",*

*"Comment":"Перезвонить и уточнить",*

*"PatientName":"Борис",*

*"PatientSurname":"Бубаков",*

*"Phone":"8-800-555-35-35"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "true",*

*"ОписаниеОшибки": "",*

*"УИД": "56621317-8ac9-11ef-9542-08979885f491"*

*}*

*}*

1. **Создание листа ожидания (FastBookAnAppointmentWithClient )**

Создадим лист ожидания с явно заданным клиентом, также передадим туда номенклатуру.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Method":"FastBookAnAppointmentWithClient",*

*"Clinic":"f679444a-22b7-11df-8618-002618dcef2c",*

*"TimeBegin":"14:00:00",*

*"Date":"18.10.2024",*

*"Comment":"Проверить список работ",*

*"Client":"92c7ea9d-2cab-11e4-9f84-1078d2d69bb4",*

*"Service":"222df5d1-4964-11e9-82be-40167e631f2e; 9fa37e64-4952-11e9-82be-40167e631f2e",*

*"DurationType":"ServiceDuration"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "true",*

*"ОписаниеОшибки": "",*

*"УИД": "56621319-8ac9-11ef-9542-08979885f491"*

*}*

*}*

## AppointmentStatus (Получение статуса заявки)

**Стандартный шаблон URL (PATTERN\_URL):** /AppointmentStatus

**HTTP-Метод POST**. Получение статуса конкретной заявки на данный момент. Возвращается код статуса и его расшифровка. Код статуса вычисляется на основе момента времени и состояния заявки, а не возвращает состояние заявки!

Является аналогом веб-сервиса GetAppointmentStatus.

Параметры в теле запроса:

|  |  |  |  |
| --- | --- | --- | --- |
| **Наименование** | **Обязательный** | **Тип значения** | **Описание** |
| Key | Да | string | Значение «Ключ API» для конкретной настройки обмена |
| GUID | Да | string | УИД заявки, чей статус надо получить |

#### **Примеры**:

1. **Получим статус заявки, сформированной с сайта до текущей даты**

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"GUID": "8a361480-854f-11ef-9541-08979885f491"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "4",*

*"ОписаниеРезультата": "Не пришел"*

*}*

*}*

Получим статус заявки, которую уже подтвердили в базе, которая запланирована на будущее время.

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"GUID": "de8ae160-849c-11ef-9541-08979885f491"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "2",*

*"ОписаниеРезультата": "Обработана"*

*}*

*}*

## AppointmentCancel (Отменить заявку)

**Стандартный шаблон URL (PATTERN\_URL):** /AppointmentCancel

**HTTP-Метод POST.** Отмена переданной заявки. Возвращается результат попытки отменить заявку (true - успех, false - провал) и описание ошибки в случае провала.

Является аналогом веб-сервиса CancelBookAnAppointment.

Параметры в теле запроса:

|  |  |  |  |
| --- | --- | --- | --- |
| **Наименование** | **Обязательный** | **Тип значения** | **Описание** |
| Key | Да | string | Значение «Ключ API» для конкретной настройки обмена |
| GUID | Да | string | УИД заявки на удаление |
| Reason | Да\* | string | Текст причины отмены заявки \* - может быть пустая строка |
| AdditionalInformation | Да\* | string | Дополнительная информация об удалении \* - может быть пустая строка |

При успешной отмене заявки не создаётся запись о причине отмены заявки, поэтому такие заявки не отображаются в отчёте «Анализ причин закрытия заявок».

#### **Примеры**:

1. **Отмена заявки**

Тело запроса JSON:

*{*

*"Key": "1111aaaa2222bbbb3333cccc4444dddd",*

*"Reason": "Тест",*

*"AdditionalInformation": "",*

*"GUID": "8a361480-854f-11ef-9541-08979885f491"*

*}*

Возвращаемый результат:

Тело ответа:

*{*

*"Ответ": {*

*"Результат": "true",*

*"ОписаниеОшибки": ""*

*}*

*}*

## DictionaryData (Получение данных из базы)

**Стандартный шаблон URL (PATTERN\_URL):** /DictionaryData

**HTTP-Метод POST**. Получение данных из информационной базы в соответствии с настройками обмена с сайтом и переданными параметрами. Подробнее в описании параметра Method [ниже](#_Описание параметра Method:_2).

Является аналогом веб-сервисов: GetListClinic, GetListEmployees, GetNomenclatureAndPrices.

Параметры в теле запроса:

|  |  |  |  |
| --- | --- | --- | --- |
| **Наименование** | **Обязательный** | **Тип значения** | **Описание** |
| Key | Да | string | Значение «Ключ API» для конкретной настройки обмена |
| Method | Да | string | Имя модели поведения сервиса. Может быть: GetListClinic, GetListEmployees, GetNomenclatureAndPrices |
| SearchName | Нет | string | Строка для частичного поиска . Игнорируется методом GetListClinic |
| EmployeeID | Нет | string | УИД или УИДы сотрудников. Используется для GetListEmployees |
| Clinic | Нет | string | УИД или УИДы клиник, по которым будет применён отбор.  Нежелательно использовать без необходимости. Используется для GetListEmployees |

#### **Описание параметра Method:**

Параметр «Method» обязателен. Если он не задан, то вернётся ошибка. Параметр «Method» определяет поведение обработки:

**GetListClinic** – Получение списка клиник из базы данных. Возвращается Наименование клиники и его УИД.

**GetListEmployees** – Получение списка сотрудников из базы данных. При получении учитывается заданный отбор в настройках обмена с сайтами (настройки, чей ключ будет передан) и отбор по заданным параметрам. Отбор можно накладывать на часть Представления сотрудника (Наименование) и/или передавать в отбор перечисление УИДов искомых сотрудников и/или искать сотрудников, зафиксированных в подразделении конкретных клиник (параметр Clinic). Последний отбор через тело запроса не стоит использовать без необходимости для повышения скорости работы.

**GetNomenclatureAndPrices** – Получение списка номенклатуры и установленной на неё цены. При получении учитывается отбор в настройках обмена с сайтами, ключ который передан. Дополняет отбор из настроек обмена с сайтом отбор по части наименования номенклатуры (SearchName).

#### **Примеры**:

1. **Получение из базы список филиалов (GetListClinic)**

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "Method": "GetListClinic"
}
```

Возвращаемый результат:

Тело ответа:

```json
{
  "Ответ": {
    "Клиника": [
      {
        "Наименование": "Второй центр",
        "УИД": "4c68deb4-22c3-11df-8618-002618dcef2c"
      },
      {
        "Наименование": "Третий центр",
        "УИД": "66abf7b4-2ff9-11df-8625-002618dcef2c"
      },
      {
        "Наименование": "Центральная клиника",
        "УИД": "f679444a-22b7-11df-8618-002618dcef2c"
      }
    ]
  }
}
```

1. **Получение из базы списка сотрудников с отбором (GetListEmployees)**

В настройках обмена с сайтом отбираются сотрудники, у которых в имени есть «Тест». В запросе наложим свой отбор по полному наименованию сотрудника - Там должно быть слово «бар».

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "Method": "GetListEmployees",
  "SearchName": "бар"
}
```

Возвращаемый результат: Пустое перечисление

Тело ответа:

```json
{
  "Ответ": {}
}
```

Если мы уберём отбор по «бар», то получим результат отбора по настройкам обмена с сайтом.

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "Method": "GetListEmployees"
}
```

Возвращаемый результат: сотрудники согласно отбору настроек с сайтом

Тело ответа:

```json
{
  "Ответ": {
    "Сотрудник": {
      "UID": "38861e66-8a01-11ef-9542-08979885f491",
      "Наименование": "Тест Тест",
      "Фамилия": "Тест",
      "Имя": "Тест",
      "Отчество": "Тест",
      "Специализация": "",
      "Организация": "f679444a-22b7-11df-8618-002618dcef2c",
      "ОсновныеУслуги": ""
    }
  }
}
```

Если мы уберём из настроек обмена с сайтом отбор по Тест, то можно задавать отбор по УИДам сотрудников и части значения Наименования сотрудников.

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "Method": "GetListEmployees",
  "SearchName": "бар"
}
```

Возвращаемый результат: Перечисление с отбором по наименованию

Тело ответа:

```json
{
  "Ответ": {
    "Сотрудник": [
      {
        "UID": "ac30e13a-3087-11dc-8594-005056c00008",
        "Наименование": "Барбышева Евгения Петровна",
        "Фамилия": "Барбышева",
        "Имя": "Евгения",
        "Отчество": "Петровна",
        "Специализация": "Офтальмология",
        "Организация": "f679444a-22b7-11df-8618-002618dcef2c",
        "ОсновныеУслуги": {
          "ОсновнаяУслуга": [
            {
              "UID": "6d9fb0ca-f27c-11e5-827e-40167e631f2e",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "1e86b93c-0b31-11e4-87f8-002618dcef2c",
              "Продолжительность": "0001-01-01T00:00:00"
            }
          ]
        }
      },
      {
        "UID": "38861e67-8a01-11ef-9542-08979885f491",
        "Наименование": "Барнасов Виктор",
        "Фамилия": "Барнасов",
        "Имя": "Виктор",
        "Отчество": "Викторович",
        "Специализация": "",
        "Организация": "f679444a-22b7-11df-8618-002618dcef2c",
        "ОсновныеУслуги": ""
      },
      {
        "UID": "2eb1f97b-6a3c-11e9-936d-1856809fe650",
        "Наименование": "Барногов Юрий Сергеевич",
        "Фамилия": "Барногов",
        "Имя": "Юрий",
        "Отчество": "Сергеевич",
        "Специализация": "Хирургия",
        "Организация": "66abf7b4-2ff9-11df-8625-002618dcef2c",
        "ОсновныеУслуги": {
          "ОсновнаяУслуга": [
            {
              "UID": "5210c9dc-65a2-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa0-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa1-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa2-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa3-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa5-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa6-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa7-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfa8-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfaa-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfad-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfae-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfaf-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb0-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb1-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb2-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb3-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb4-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb7-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            },
            {
              "UID": "dc58bfb8-65b4-11e9-936d-1856809fe650",
              "Продолжительность": "0001-01-01T00:00:00"
            }
          ]
        }
      }
    ]
  }
}
```

Можно дополнить ли заменить отбор - перечислив через «;» УИДы искомых сотрудников.

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "Method": "GetListEmployees",
  "SearchName": "бар",
  "EmployeeID": "38861e67-8a01-11ef-9542-08979885f491"
}
```

Возвращаемый результат: Перечисление с отбором по наименованию

Тело ответа:

```json
{
  "Ответ": {
    "Сотрудник": {
      "UID": "38861e67-8a01-11ef-9542-08979885f491",
      "Наименование": "Барнасов Виктор",
      "Фамилия": "Барнасов",
      "Имя": "Виктор",
      "Отчество": "Викторович",
      "Специализация": "",
      "Организация": "f679444a-22b7-11df-8618-002618dcef2c",
      "ОсновныеУслуги": ""
    }
  }
}
```

1. **Получение из базы номенклатуры и их цены с отбором по имени (GetNomenclatureAndPrices)**

Принцип работы аналогичен получению сотрудников, только для номенклатуры нельзя задавать отбор в запросе на ссылку, а параметр «Clinic» не учитывается.

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "Method": "GetNomenclatureAndPrices",
  "SearchName": "Тест"
}
```

Возвращаемый результат: Номенклатура из центральной клиники с «Тест» в названии

Тело ответа:

```json
{
  "Ответ": {
    "Каталог": [
      {
        "UID": "ca040340-9f39-11e6-8221-985fd33a0f52",
        "Наименование": "FTI – тест",
        "Артикул": "",
        "БазоваяЕдиницаИзмерения": "",
        "Цена": "200",
        "Продолжительность": "0001-01-01T00:15:00",
        "Вид": "Услуга",
        "Родитель": "ca04032d-9f39-11e6-8221-985fd33a0f52",
        "ЭтоПапка": "false"
      },
      {
        "UID": "ca040343-9f39-11e6-8221-985fd33a0f52",
        "Наименование": "Надпороговые тесты (тест Фоулера, тест СИСИ, тест Люшера)",
        "Артикул": "",
        "БазоваяЕдиницаИзмерения": "",
        "Цена": "170",
        "Продолжительность": "0001-01-01T00:15:00",
        "Вид": "Услуга",
        "Родитель": "ca04032d-9f39-11e6-8221-985fd33a0f52",
        "ЭтоПапка": "false"
      },
      {
        "UID": "1056e9ce-fc4b-11e3-87f5-002618dcef2c",
        "Наименование": "Психологическое тестирование",
        "Артикул": "",
        "БазоваяЕдиницаИзмерения": "",
        "Цена": "150",
        "Продолжительность": "0001-01-01T00:15:00",
        "Вид": "Услуга",
        "Родитель": "5210c9be-65a2-11e9-936d-1856809fe650",
        "ЭтоПапка": "false"
      }
    ]
  }
}
```

## Reservation (Создание брони)

**Стандартный шаблон URL (PATTERN\_URL):** /Reservation

**HTTP-Метод POST**. По переданным параметрам создаёт бронь на сотрудника/оборудования в конкретную клинику на конкретное дату и время. В теле результата будет УИД созданной брони.

Является аналогом веб-сервиса GetReserve.

Параметры в теле запроса:

|  |  |  |  |
| --- | --- | --- | --- |
| **Наименование** | **Обязательный** | **Тип значения** | **Описание** |
| Key | Да | string | Значение «Ключ API» для конкретной настройки обмена |
| Date | Да | dateTime | **Дата**, на которую оформляется бронь. Если указано вместе с временем - время игнорируется |
| TimeBegin | Да | dateTime | **Время**, на начало которого оформляется бронь. Если указано вместе с датой - дата игнорируется |
| Duration | Нет | dateTime | Планируемая длительность брони. Ожидается **время**. Если указано вместе с датой - дата игнорируется |
| Clinic | Да | string | УИД клиники |
| EmployeeID | Да | string | УИД сотрудника или оборудования, к которому оформляется бронь.  **ВАЖНО**: Для записи в кабинет (УИД оборудования) необходимо настроить учётную политику «Режим записи на приём» в значение «в кабинет», иначе будет ошибка |
| EquipmentCabinet | Нет | string | УИД оборудования, к которому оформляется бронь. Используется, когда нужно записать и сотрудник и кабинет/оборудования (EmployeeID будет иметь УИД сотрудника) |

При формировании брони допускается указывать в качестве EmployeeID оборудование, если значение режима записи на приём учётной политики настроена как «в кабинет», иначе необходимо использовать сотрудника. Если время брони на сотрудник и/или кабинет пересекается с уже созданным, то вернётся ошибка записи документа.

#### **Примеры**:

1. **Создание брони в базе (GetReserve)**

Создадим бронь на сотрудника и оборудование на вечер дня

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "EmployeeID": "38861e66-8a01-11ef-9542-08979885f491",
  "EquipmentCabinet": "5210c9c3-65a2-11e9-936d-1856809fe650",
  "Clinic": "f679444a-22b7-11df-8618-002618dcef2c",
  "TimeBegin": "18:10:00",
  "Date": "15.10.2024"
}
```

Возвращаемый результат: Успешная запись

Тело ответа:

```json
{
  "Ответ": {
    "Результат": "true",
    "ОписаниеОшибки": "",
    "УИД": "18b069c4-8a19-11ef-9542-08979885f491"
  }
}
```

Но если мы попытаемся создать новую бронь на это же время, то получим ошибку из-за наложения двух заявок.

Тело запроса JSON:

```json
{
  "Key": "1111aaaa2222bbbb3333cccc4444dddd",
  "EmployeeID": "38861e67-8a01-11ef-9542-08979885f491",
  "Clinic": "f679444a-22b7-11df-8618-002618dcef2c",
  "TimeBegin": "18:10:00",
  "Date": "15.10.2024"
}
```

Возвращаемый результат: Ошибка при записи документа (Код ошибки 500)

Тело ответа:

*Не удалось записать документ. 14.10.2024 15:49:15 - {ОбщийМодуль.ВебИнтеграция.Модуль(358)}: Ошибка при вызове метода контекста (Записать): Не удалось записать: "Заявка"!*

# Веб-сервисы 1С

## GetEnlargementSchedule (укрупненное расписание)

**GetEnlargementSchedule** (StartDate[dateTime], FinishDate[dateTime]).

Описание: Возвращает укрупненное расписание сотрудников, т.е. расписание без учета перерывов и занятого клиентами времени. Образуется посредством объединения самого раннего времени работы и самого позднего в один период (в разрезе дня).

Возможные ошибки:

1. Ошибка при преобразовании StartDate в дату;
2. Ошибка при преобразовании FinishDate в дату.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:GetEnlargementSchedule>

<ru:StartDate>2017-03-01T00:00:00</ru:StartDate>

<ru:FinishDate>2017-03-01T00:00:00</ru:FinishDate>

</ru:GetEnlargementSchedule>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetEnlargementScheduleResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ГрафикиДляСайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<ГрафикДляСайта>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<СотрудникФИО>Ковалёва И.М.</СотрудникФИО>

<СотрудникID>6cf96534-3870-11e2-87ba-002618dcef2c</СотрудникID>

<Специализация>Офтальмология</Специализация>

<ПериодыГрафика>

<СвободноеВремя>

<ПериодГрафика>

<Дата>2017-03-01T00:00:00</Дата>

<ВремяНачала>2017-03-01T09:00:00</ВремяНачала>

<ВремяОкончания>2017-03-01T20:00:00</ВремяОкончания>

</ПериодГрафика>

</СвободноеВремя>

<ЗанятоеВремя/>

</ПериодыГрафика>

<ДлительностьПриема>0001-01-01T00:15:00</ДлительностьПриема>

</ГрафикДляСайта>

<ГрафикДляСайта>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<СотрудникФИО>Филатова М.С.</СотрудникФИО>

<СотрудникID>eab46ee6-94b1-11e3-87ec-002618dcef2c</СотрудникID>

<Специализация>Неврология</Специализация>

<ПериодыГрафика>

<СвободноеВремя>

<ПериодГрафика>

<Дата>2017-03-01T00:00:00</Дата>

<ВремяНачала>2017-03-01T09:00:00</ВремяНачала>

<ВремяОкончания>2017-03-01T20:00:00</ВремяОкончания>

</ПериодГрафика>

</СвободноеВремя>

<ЗанятоеВремя/>

</ПериодыГрафика>

<ДлительностьПриема>0001-01-01T00:15:00</ДлительностьПриема>

</ГрафикДляСайта>

</ГрафикиДляСайта>]]></m:return>

</m:GetEnlargementScheduleResponse>

</soap:Body>

</soap:Envelope>

## GetSchedule (детальное расписание)

**GetSchedule** (StartDate[dateTime], FinishDate[dateTime]).

Описание: Возвращает расписание сотрудников с учетом перерывов и временем занятым заявками клиентов.

Возможные ошибки:

1. Ошибка при преобразовании StartDate в дату;
2. Ошибка при преобразовании FinishDate в дату.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:GetSchedule>

<ru:StartDate>2017-03-01T00:00:00</ru:StartDate>

<ru:FinishDate>2017-03-30T00:00:00</ru:FinishDate>

</ru:GetSchedule>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetScheduleResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ГрафикиДляСайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<ГрафикДляСайта>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<СотрудникФИО>Барышева Евгения Петровна</СотрудникФИО>

<СотрудникID>ac30e13a-3087-11dc-8594-005056c00008</СотрудникID>

<Специализация>Офтальмология</Специализация>

<ПериодыГрафика>

<СвободноеВремя>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2017-03-02T00:00:00</Дата>

<ВремяНачала>2017-03-02T09:00:00</ВремяНачала>

<ВремяОкончания>2017-03-02T12:30:00</ВремяОкончания>

<ВидВремени>Рабочее время</ВидВремени>

</ПериодГрафика>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2017-03-02T00:00:00</Дата>

<ВремяНачала>2017-03-02T13:00:00</ВремяНачала>

<ВремяОкончания>2017-03-02T14:30:00</ВремяОкончания>

<ВидВремени>Рабочее время</ВидВремени>

</ПериодГрафика>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2017-03-03T00:00:00</Дата>

<ВремяНачала>2017-03-03T09:00:00</ВремяНачала>

<ВремяОкончания>2017-03-03T09:15:00</ВремяОкончания>

<ВидВремени>Рабочее время</ВидВремени>

</ПериодГрафика>

</СвободноеВремя>

<ЗанятоеВремя>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2017-03-03T00:00:00</Дата>

<ВремяНачала>2017-03-03T09:45:00</ВремяНачала>

<ВремяОкончания>2017-03-03T10:00:00</ВремяОкончания>

<ВидВремени>Мед. осмотр</ВидВремени>

<Цвет>160224224</Цвет>

</ПериодГрафика>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2017-03-03T00:00:00</Дата>

<ВремяНачала>2017-03-03T10:00:00</ВремяНачала>

<ВремяОкончания>2017-03-03T10:15:00</ВремяОкончания>

<ВидВремени>Не занимать</ВидВремени>

<Цвет>255000000</Цвет>

</ПериодГрафика>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2017-03-03T00:00:00</Дата>

<ВремяНачала>2017-03-03T10:15:00</ВремяНачала>

<ВремяОкончания>2017-03-03T12:45:00</ВремяОкончания>

<ВидВремени>3</ВидВремени>

<Цвет>255128128</Цвет>

</ПериодГрафика>

</ЗанятоеВремя>

</ПериодыГрафика>

<ДлительностьПриема>0001-01-01T00:00:00</ДлительностьПриема>

</ГрафикДляСайта>

</ГрафикиДляСайта>]]></m:return>

</m:GetScheduleResponse>

</soap:Body>

</soap:Envelope>

## GetSchedule20 (детальное расписание)

**GetSchedule20** (StartDate[dateTime], FinishDate[dateTime], Params[Structure]).

**Params** – структура с отборами. Указание любого отбора не обязательно. Доступные ключи отборов:

**Clinic** [string] – уникальный идентификатор клиники в 1С;

**Employees** [string] - уникальные идентификаторы сотрудников в 1С, разделенные символом «;» (точка с запятой);

Пример: <core:Value>2eb1f97b-6a3c-11e9-936d-1856809fe650;99868528-0928-11dc-93d1-0004614ae652</core:Value>.

**Format** [string] – формат возвращаемого значения. Доступные форматы: «JSON» – возвращает расписание в формате json, «ZipXML» – возвращает архив в виде строки BASE64, содержащий расписание в формате xml; «ZipJSON» – возвращает архив в виде строки BASE64, содержащий расписание в формате xml.

Описание: Возвращает расписание сотрудников с учетом перерывов и временем, занятым заявками клиентов.

Возможные ошибки:

1. Ошибка при преобразовании StartDate в дату;
2. Ошибка при преобразовании FinishDate в дату.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc" xmlns:core="http://v8.1c.ru/8.1/data/core">

<soap:Header/>

<soap:Body>

<ru:GetSchedule20>

<ru:StartDate>2022-06-01T00:00:00</ru:StartDate>

<ru:FinishDate>2022-06-01T23:59:59</ru:FinishDate>

<ru:Params>

<core:Property name="Clinic">

<core:Value>f679444a-22b7-11df-8618-002618dcef2</core:Value>

</core:Property>

<core:Property name="Employees">

<core:Value>2eb1f97b-6a3c-11e9-936d-1856809fe650;99868528-0928-11dc-93d1-0004614ae652</core:Value>

</core:Property>

</ru:Params>

</ru:GetSchedule20>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetSchedule20Response xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ГрафикиДляСайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<ГрафикДляСайта>

<Клиника>66abf7b4-2ff9-11df-8625-002618dcef2c</Клиника>

<СотрудникФИО>Безногов Юрий Сергеевич</СотрудникФИО>

<СотрудникID>2eb1f97b-6a3c-11e9-936d-1856809fe650</СотрудникID>

<Специализация>Хирургия</Специализация>

<ПериодыГрафика>

<СвободноеВремя>

<ПериодГрафика>

<Клиника>66abf7b4-2ff9-11df-8625-002618dcef2c</Клиника>

<Дата>2022-06-03T00:00:00</Дата>

<ВремяНачала>2022-06-03T09:00:00</ВремяНачала>

<ВремяОкончания>2022-06-03T20:00:00</ВремяОкончания>

<ВидВремени>624f2a40-5aa8-4f01-83f4-0f38535364bb</ВидВремени>

</ПериодГрафика>

</СвободноеВремя>

<ЗанятоеВремя/>

</ПериодыГрафика>

<ДлительностьПриема>0001-01-01T00:00:00</ДлительностьПриема>

</ГрафикДляСайта>

<ГрафикДляСайта>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<СотрудникФИО>Денисов Дмитрий Алексеевич</СотрудникФИО>

<СотрудникID>99868528-0928-11dc-93d1-0004614ae652</СотрудникID>

<Специализация>Терапия</Специализация>

<ПериодыГрафика>

<СвободноеВремя>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2022-06-03T00:00:00</Дата>

<ВремяНачала>2022-06-03T09:00:00</ВремяНачала>

<ВремяОкончания>2022-06-03T12:00:00</ВремяОкончания>

<ВидВремени>624f2a40-5aa8-4f01-83f4-0f38535364bb</ВидВремени>

</ПериодГрафика>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2022-06-03T00:00:00</Дата>

<ВремяНачала>2022-06-03T12:30:00</ВремяНачала>

<ВремяОкончания>2022-06-03T21:00:00</ВремяОкончания>

<ВидВремени>624f2a40-5aa8-4f01-83f4-0f38535364bb</ВидВремени>

</ПериодГрафика>

</СвободноеВремя>

<ЗанятоеВремя>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2022-06-03T00:00:00</Дата>

<ВремяНачала>2022-06-03T12:00:00</ВремяНачала>

<ВремяОкончания>2022-06-03T12:30:00</ВремяОкончания>

<ВидВремени>5210c9ac-65a2-11e9-936d-1856809fe650</ВидВремени>

</ПериодГрафика>

</ЗанятоеВремя>

</ПериодыГрафика>

<ДлительностьПриема>0001-01-01T00:00:00</ДлительностьПриема>

</ГрафикДляСайта>

<ГрафикДляСайта>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<СотрудникФИО>Безногов Юрий Сергеевич</СотрудникФИО>

<СотрудникID>2eb1f97b-6a3c-11e9-936d-1856809fe650</СотрудникID>

<Специализация>Хирургия</Специализация>

<ПериодыГрафика>

<СвободноеВремя>

<ПериодГрафика>

<Клиника>f679444a-22b7-11df-8618-002618dcef2c</Клиника>

<Дата>2022-06-03T00:00:00</Дата>

<ВремяНачала>2022-06-03T20:00:00</ВремяНачала>

<ВремяОкончания>2022-06-03T21:00:00</ВремяОкончания>

<ВидВремени>624f2a40-5aa8-4f01-83f4-0f38535364bb</ВидВремени>

</ПериодГрафика>

</СвободноеВремя>

<ЗанятоеВремя/>

</ПериодыГрафика>

<ДлительностьПриема>0001-01-01T00:00:00</ДлительностьПриема>

</ГрафикДляСайта>

<ОшибкаПараметров>Ошибки разбора параметра Params:

Филиал не найден в базе по UUID: f679444a-22b7-11df-8618-002618dcef2</ОшибкаПараметров>

</ГрафикиДляСайта>]]></m:return>

</m:GetSchedule20Response>

</soap:Body>

</soap:Envelope>

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc" xmlns:core="http://v8.1c.ru/8.1/data/core">

<soap:Header/>

<soap:Body>

<ru:GetSchedule20>

<ru:StartDate>2022-08-01T00:00:00</ru:StartDate>

<ru:FinishDate>2022-08-01T23:59:59</ru:FinishDate>

<ru:Params>

<core:Property name="Clinic">

<core:Value>f679444a-22b7-11df-8618-002618dcef2с</core:Value>

</core:Property>

<core:Property name="Employees">

<core:Value>2eb1f97b-6a3c-11e9-936d-1856809fe650;99868528-0928-11dc-93d1-0004614ae652</core:Value>

</core:Property>

<core:Property name="Format">

<core:Value>JSON</core:Value>

</core:Property>

</ru:Params>

</ru:GetSchedule20>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetSchedule20Response xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">{

"ГрафикиДляСайта": {

"ГрафикДляСайта": [

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"СотрудникФИО": "Барбышева Евгения Петровна",

"СотрудникID": "ac30e13a-3087-11dc-8594-005056c00008",

"Специализация": "Офтальмология",

"ПериодыГрафика": {

"СвободноеВремя": {

"ПериодГрафика": [

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"Дата": "2022-08-01T00:00:00",

"ВремяНачала": "2022-08-01T09:00:00",

"ВремяОкончания": "2022-08-01T13:00:00",

"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"

}

]

},

"ЗанятоеВремя": ""

},

"ДлительностьПриема": "0001-01-01T00:00:00"

},

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"СотрудникФИО": "Красильникова Наталья Семеновна",

"СотрудникID": "e7005e6d-65c9-11e9-936d-1856809fe650",

"Специализация": "Дерматология и косметология",

"ПериодыГрафика": {

"СвободноеВремя": {

"ПериодГрафика": [

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"Дата": "2022-08-01T00:00:00",

"ВремяНачала": "2022-08-01T09:00:00",

"ВремяОкончания": "2022-08-01T20:00:00",

"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"

}

]

},

"ЗанятоеВремя": ""

},

"ДлительностьПриема": "0001-01-01T00:30:00"

},

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"СотрудникФИО": "Барбышева Евгения Петровна",

"СотрудникID": "ac30e13a-3087-11dc-8594-005056c00008",

"Специализация": "Офтальмология",

"ПериодыГрафика": {

"СвободноеВремя": {

"ПериодГрафика": [

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"Дата": "2022-08-01T00:00:00",

"ВремяНачала": "2022-08-01T13:30:00",

"ВремяОкончания": "2022-08-01T17:00:00",

"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"

},

{

"Клиника": "f679444a-22b7-11df-8618-002618dcef2c",

"Дата": "2022-08-01T00:00:00",

"ВремяНачала": "2022-08-01T17:30:00",

"ВремяОкончания": "2022-08-01T20:00:00",

"ВидВремени": "624f2a40-5aa8-4f01-83f4-0f38535364bb"

}

]

},

"ЗанятоеВремя": ""

},

"ДлительностьПриема": "0001-01-01T00:00:00"

}

]

}

}</m:return>

</m:GetSchedule20Response>

</soap:Body>

</soap:Envelope>

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc" xmlns:core="http://v8.1c.ru/8.1/data/core">

<soap:Header/>

<soap:Body>

<ru:GetSchedule20>

<ru:StartDate>2022-08-01T00:00:00</ru:StartDate>

<ru:FinishDate>2022-08-01T23:59:59</ru:FinishDate>

<ru:Params>

<core:Property name="Clinic">

<core:Value>f679444a-22b7-11df-8618-002618dcef2с</core:Value>

</core:Property>

<core:Property name="Employees">

<core:Value>2eb1f97b-6a3c-11e9-936d-1856809fe650;99868528-0928-11dc-93d1-0004614ae652</core:Value>

</core:Property>

<core:Property name="Format">

<core:Value>ZipXML</core:Value>

</core:Property>

</ru:Params>

</ru:GetSchedule20>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetSchedule20Response xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">UEsDBBQAAAgIAPtUDFXsmhfKxgIAACISAAAOAAAAdjhfNDQ0MF8xMS54bWztWM1O

20AQPpeniHLgtnjttR2bn3LppVJ7oodejWOHSBCqJGo4BopoJZBQKVUrJIIi9QHC

T9S0+eEVZp+kr9DZtR1MnRAOSVVKIluOPd98M7Mz/uL4V/t6sVQu5gu5p7Pr5YXl

rY311FuvWMpvFpbS6hxNL8/mygszwgafeBUafBda8BP3Y2jzQ6hDA37wHWik0LNQ

WkqvqOng6/wWnq2Vy2/mFaVSqcxV2NxmMadolKrK65cvVtw1b8O5weZHg0m+UCo7

BddLy5yeJJL6I6UAFcBOoI2QroRJg29mbF3XHaJpqxmiqlmfWKZqEUo1PGRdz9dc

4akkXSPOOvT4Dq/yd3AVmr/BV6gJCHzEpKpwzvf5B2jCBa4PfMbDJZ4glB+m4Aya

wht6eLmLxDLWHZRDoz5/JsyOy6inMocwasl6XGIZto71GNQwXYofa0iMgOCG/xoz

20NDQxb+HSvZEynLump8VywtLvQBdDD3Nu6X0hpy3+EcRRCVV9HYgyu+f6uB0fJG

mVwg5lzgMNEeLt0RYpvQ6dMlCQfTTWYIItpjDBiOm0Y1jVAkUF9ROi+3wD+GiXn2

64FTtL+Xi5bgseM8Qz0GstYw2x50Ja4btSHGrbLB3AP94hFwHa4ifDDSAmFquq85

OiWG41hE96lKLObjDPrMMpjBTH11NQw1mKDfUmV0T6OBGzkjMuMvohJ+iD24hVFi

c6ncYzDDfuMsIFNT3gUYlW/jDXUAZ9JZFCTheMepRG6JWbiX/0yY1UiF+5d18ESm

tY1Xg1pbcrKkHp4Gt4QwCD2s90dhTIroZVD7PDNLTMO1sTLPJjbDU9UyTIvavmca

dAyKeCyHpiOLielhClopUSvW3hFKP9XKB66VGp1q5V/SSvY4tXL6zDjVwfHoID7X

sYk9M2Yerg4+htZnJtf66U/gf/B3IYlKvMsRuEUlfC30G1BLAQIuAxQAAAgIAPtU

DFXsmhfKxgIAACISAAAOACQAAAAAAAAAAAC0gQAAAAB2OF80NDQwXzExLnhtbAoA

IAAAAAAAAQAYAADx3/INrtgBAPHf8g2u2AEA8d/yDa7YAVBLBQYAAAAAAQABAGAA

AADyAgAAAAA=</m:return>

</m:GetSchedule20Response>

</soap:Body>

</soap:Envelope>

## GetReserve (бронь времени на оформление записи с сайта)

**GetReserve** (Specialization[string], Date[dateTime], TimeBegin[dateTime], EmployeeID[string], Clinic[string]).

**EmployeeID** – уникальный идентификатор сотрудника.

**Clinic** – уникальный идентификатор клиники.

Описание: Производит резервирование времени, возвращает уникальный идентификатор заявки, который необходимо использовать в «BookAnAppointment», в качестве значения GUID.

Возможные ошибки:

1. Ошибка при получении уникального идентификатора на основе EmployeeID;
2. Ошибка при выполнении поиска сотрудника по уникальному идентификатору;
3. Ошибка при преобразовании Date в дату;
4. Ошибка при преобразовании TimeBegin в Дату;
5. Ошибка при расчете времени окончания: в базе не настроена периодичность бронирования и у сотрудника не задана длительность приема;
6. Ошибка при расчете времени окончания;
7. Ошибка при поиске клиники по переданному наименованию;
8. Не удалось записать документ Заявка.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:GetReserve>

<ru:Specialization>Неврология</ru:Specialization>

<ru:Date>2017-03-17T00:00:00</ru:Date>

<ru:TimeBegin>0001-01-01T15:00:00</ru:TimeBegin>

<ru:EmployeeID>ac30e139-3087-11dc-8594-005056c00008</ru:EmployeeID>

<ru:Clinic>f679444a-22b7-11df-8618-002618dcef2c</ru:Clinic>

</ru:GetReserve>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetReserveResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ОтветНаЗаписьССайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Результат>true</Результат>

<ОписаниеОшибки> </ОписаниеОшибки>

<УИД>9cc6b9fc-0b04-11e7-b13c-00e051000230</УИД>

</ОтветНаЗаписьССайта>]]></m:return>

</m:GetReserveResponse>

</soap:Body>

</soap:Envelope>

## BookAnAppointment (запись с сайта)

**BookAnAppointment** (EmployeeID[string], PatientSurname[string], PatientName[string], PatientFatherName[string], Date[dateTime], TimeBegin[dateTime], Comment[string], Phone[string], Email[string], Address[string], Clinic[string], GUID[string]).

**EmployeeID** – уникальный идентификатор сотрудника.

**Clinic** – уникальный идентификатор клиники.

Описание: Производит запись клиента по уникальному идентификатору брони, который можно получить в следствие бронирования времени, с помощью «GetReserve».

Возможные ошибки:

1. Ошибка при получении уникального идентификатора на основе EmployeeID;
2. Ошибка при выполнении поиска сотрудника по уникальному идентификатору;
3. Ошибка при преобразовании Date в дату;
4. Ошибка при преобразовании TimeBegin в Дату;
5. Ошибка при расчете времени окончания: в базе не настроена периодичность бронирования и у сотрудника не задана длительность приема;
6. Ошибка при расчете времени окончания;
7. Ошибка при поиске клиники по переданному наименованию;
8. Не удалось записать документ Заявка.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:BookAnAppointment>

<ru:EmployeeID>ac30e139-3087-11dc-8594-005056c00008</ru:EmployeeID>

<ru:PatientSurname>Иванов</ru:PatientSurname>

<ru:PatientName>Иван</ru:PatientName>

<ru:PatientFatherName>Иванович</ru:PatientFatherName>

<ru:Date>2017-03-17T00:00:00</ru:Date>

<ru:TimeBegin>0001-01-01T13:10:00</ru:TimeBegin>

<ru:Comment>Комментарий</ru:Comment>

<ru:Phone>89876543210</ru:Phone>

<ru:Email>bit@1cbit.ru</ru:Email>

<ru:Address>Ленина 1</ru:Address>

<ru:Clinic>f679444a-22b7-11df-8618-002618dcef2c</ru:Clinic>

<ru:GUID>9cc6b9fc-0b04-11e7-b13c-00e051000230</ru:GUID>

</ru:BookAnAppointment>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:BookAnAppointmentResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ОтветНаЗаписьССайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Результат>true</Результат>

<ОписаниеОшибки> </ОписаниеОшибки>

</ОтветНаЗаписьССайта>]]></m:return>

</m:BookAnAppointmentResponse>

</soap:Body>

</soap:Envelope>

## BookAnAppointmentWithParams (запись с сайта)

**BookAnAppointmentWithParams** (EmployeeID[string], PatientSurname[string], PatientName[string], PatientFatherName[string], Date[dateTime], TimeBegin[dateTime], Comment[string], Phone[string], Email[string], Address[string], Clinic[string], GUID[string], Params[Structure]).

**EmployeeID** – уникальный идентификатор сотрудника.

**Clinic** – уникальный идентификатор клиники.

**Params** – структура с необязательными параметрами:

**Birthday**[dateTime] – дата рождения клиента;

**Duration**[dateTime] – длительность записи;

**DurationType**[string] – метод расчета длительности заявки. Доступен один вариант значения: «ServiceDuration» – расчет длительности заявки из длительности услуг. Для расчета необходимо указать услуги в параметре Services;

**Services**[string] – уникальные идентификаторы услуг в 1С, разделенные символом «;» (точка с запятой).

Описание: Производит запись клиента по уникальному идентификатору брони, который можно получить в следствие бронирования времени, с помощью «GetReserve».

Правила расчета длительности записи:

1. При указанных параметрах DurationTypeиServices параметр Duration игнорируется, длительность рассчитывается из нормативов услуг;
2. При указанном параметре Duration – указанная длительность;
3. Если не задана параметрами – из основной длительности приема сотрудника;
4. Если и для сотрудника она не указана – базовая периодичность планирования по Учетной политике.

Возможные ошибки:

1. Ошибка при получении уникального идентификатора на основе EmployeeID;
2. Ошибка при выполнении поиска сотрудника по уникальному идентификатору;
3. Ошибка при преобразовании Date в дату;
4. Ошибка при преобразовании TimeBegin в Дату;
5. Ошибка при расчете времени окончания: в базе не настроена периодичность бронирования и у сотрудника не задана длительность приема;
6. Ошибка при расчете времени окончания;
7. Ошибка при поиске клиники по переданному наименованию;
8. Не удалось записать документ Заявка.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc" xmlns:core="http://v8.1c.ru/8.1/data/core">

<soap:Header/>

<soap:Body>

<ru:BookAnAppointmentWithParams>

<ru:EmployeeID>ac30e139-3087-11dc-8594-005056c00008</ru:EmployeeID>

<ru:PatientSurname>Иванов</ru:PatientSurname>

<ru:PatientName>Иван</ru:PatientName>

<ru:PatientFatherName>Иванович</ru:PatientFatherName>

<ru:Date>2017-03-17T00:00:00</ru:Date>

<ru:TimeBegin>0001-01-01T13:10:00</ru:TimeBegin>

<ru:Comment>Комментарий</ru:Comment>

<ru:Phone>89876543210</ru:Phone>

<ru:Email>bit@1cbit.ru</ru:Email>

<ru:Address>Ленина 1</ru:Address>

<ru:Clinic>f679444a-22b7-11df-8618-002618dcef2c</ru:Clinic>

<ru:GUID>9cc6b9fc-0b04-11e7-b13c-00e051000230</ru:GUID>

<ru:Params>

<core:Property name="Birthday">

<core:Value>1980-09-14T00:00:00</core:Value>

</core:Property>

<core:Property name="Duration">

<core:Value>0001-01-01T01:30:00</core:Value>

</core:Property>

<core:Property name="DurationType">

<core:Value>ServiceDuration</core:Value>

</core:Property>

<core:Property name="Services">

<core:Value>eb20edcc-3ee0-11de-b0dd-0050bf5d92cb;8e045f06-da18-11e1-bab2-1803736d59cd</core:Value>

</core:Property>

</ru:Params>

</ru: BookAnAppointmentWithParams>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m: BookAnAppointmentWithParamsResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ОтветНаЗаписьССайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Результат>true</Результат>

<ОписаниеОшибки> </ОписаниеОшибки>

</ОтветНаЗаписьССайта>]]></m:return>

</m: BookAnAppointmentWithParamsResponse >

</soap:Body>

</soap:Envelope>

## GetAppointmentStatus (статус записи)

**GetAppointmentStatus** (GUID[string]).

**GUID** – уникальный идентификатор заявки.

Описание: возвращает код состояния записи и его краткое название:

|  |  |
| --- | --- |
| 0 | Ошибка |
| 1 | Новая (принята с сайта, не проверена) |
| 2 | Обработана (переведена из состояния новой полученной с сайта в иное состояние запланированной) |
| 3 | Пришел (посещение произошло или происходит сейчас) |
| 4 | Не пришел (дата посещения прошла, но все еще находится в состоянии запланированной) |
| 5 | Отменена |
| 6 | Оформляется (интервал забронировано методом GetReserve на время оформления записи с сайта) |
| 9 | Забронированное время (заявка еще не оформлена, но бронирует своё время в расписании.  По окончании времени хранения брони она будет удалена регламентным заданием «Обмен с сайтом: Отмена просроченных броней», если так и не будет переведена в иное состояние). Пример: проверка статуса после метода **GetReserve** |

Возможные ошибки, возвращаемые не в формате ответа:

1. Ошибка при получении уникального идентификатора на основе GUID;
2. Ошибка при выполнении поиска заявки по уникальному идентификатору.

### Пример запроса:

<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">

<Body>

< GetAppointmentStatus xmlns="ru.umc">

<GUID>97fca397-c589-11e1-b4b7-3859f93b5c90</GUID>

</ GetAppointmentStatus>

</Body>

</Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">

<soap:Body>

<m:CancelBookAnAppointmentResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance**"><?xml version="1.0"?>**

**<ОтветНаЗапросСтатусаЗаявки xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">**

**<Результат>3</Результат>**

**<ОписаниеРезультата>Пришел</ОписаниеРезультата>**

**</ОтветНаЗапросСтатусаЗаявки>**

</m:return>

</m:CancelBookAnAppointmentResponse>

</soap:Body>

</soap:Envelope>

## CancelBookAnAppointment (отмена записи)

**CancelBookAnAppointment** (GUID[string], AdditionalInformation [string], Reason [string]).

**GUID** – уникальный идентификатор заявки.

Описание: У заявки ставится «Пометка на удаление», состояние заявки меняется на «Отменена».

Возможные ошибки:

1. Ошибка при получении уникального идентификатора на основе GUID.
2. Ошибка при выполнении поиска заявки по уникальному идентификатору.
3. Не удалось записать документ Заявка.

### Пример запроса:

<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">

<Body>

<CancelBookAnAppointment xmlns="ru.umc">

<GUID>97fca397-c589-11e1-b4b7-3859f93b5c90</GUID>

<AdditionalInformation>Дополнительная информация</AdditionalInformation>

<Reason>Причина отмены заявки</Reason>

</CancelBookAnAppointment>

</Body>

</Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">

<soap:Body>

<m:CancelBookAnAppointmentResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance**"**>**<?xml version="1.0"?>**

**<РезультатВыполнения xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">**

**<Результат>true</Результат>**

**<ОписаниеОшибки> </ОписаниеОшибки>**

**</ РезультатВыполнения >**</m:return>

</m:CancelBookAnAppointmentResponse>

</soap:Body>

</soap:Envelope>

## FastBookAnAppointment (создать лист ожидания)

**FastBookAnAppointment** (Specialization[string], PatientSurname[string], PatientName[string], PatientFatherName[string], Date[dateTime], TimeBegin[dateTime], Comment[string], Phone[string], Email[string], Address[string], Clinic[string]).

**Clinic** – уникальный идентификатор клиники.

Описание: Создает лист ожидания записи в 1с.

Возможные ошибки:

1. Ошибка при преобразовании Date в дату;
2. Ошибка при преобразовании TimeBegin в Дату;
3. Ошибка при поиске клиники по переданному наименованию;
4. Не удалось записать документ ЛистОжидания.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:FastBookAnAppointment>

<ru:Specialization>Хирургия</ru:Specialization>

<ru:PatientSurname>Иванов</ru:PatientSurname>

<ru:PatientName>Иван</ru:PatientName>

<ru:PatientFatherName>Иванович</ru:PatientFatherName>

<ru:Date>2017-03-17T00:00:00</ru:Date>

<ru:TimeBegin>0001-01-01T14:00:00</ru:TimeBegin>

<ru:Comment>Или в 16:00</ru:Comment>

<ru:Phone>89876543210</ru:Phone>

<ru:Email>bit@1cbit.ru</ru:Email>

<ru:Address>Ул. Ленина 1</ru:Address>

<ru:Clinic>f679444a-22b7-11df-8618-002618dcef2c</ru:Clinic>

</ru:FastBookAnAppointment>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:FastBookAnAppointmentResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<ОтветНаЗаписьССайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Результат>true</Результат>

<ОписаниеОшибки> </ОписаниеОшибки>

</ОтветНаЗаписьССайта>]]></m:return>

</m:FastBookAnAppointmentResponse>

</soap:Body>

</soap:Envelope>

## GetListEmployees (список сотрудников)

**GetListEmployees ()**.

Описание: Возвращает список сотрудников с их уникальными идентификаторами.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:GetListEmployees/>

</soap:Body>

</soap:Envelope>

### Пример ответа:

soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetListEmployeesResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<Сотрудники xmlns="S2" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Сотрудник>

<UID xsi:type="xs:string">eab46ee6-94b1-11e3-87ec-002618dcef2c</UID>

<Наименование>Филатова Мария Сергеевна</Наименование>

<Фамилия>Филатова</Фамилия>

<Имя>Мария</Имя>

<Отчество>Сергеевна</Отчество>

<Специализация>Офтальмология</Специализация>

<Организация>f679444a-22b7-11df-8618-002618dcef2c</Организация>

<ОсновныеУслуги/>

<СреднийРейтинг>4,0</СреднийРейтинг>

<КраткоеОписание/>

</Сотрудник>

<Сотрудник>

<UID xsi:type="xs:string">9e8b672a-9975-11e3-87ec-002618dcef2c</UID>

<Наименование>Скрипко Юлия Александровна</Наименование>

<Фамилия>Скрипко</Фамилия>

<Имя>Юлия</Имя>

<Отчество>Александровна</Отчество>

<Специализация>Офтальмология</Специализация>

<Организация>f679444a-22b7-11df-8618-002618dcef2c</Организация>

<ОсновныеУслуги>

<ОсновнаяУслуга>

<UID>1e86b944-0b31-11e4-87f8-002618dcef2c</UID>

<Продолжительность>0001-01-01T00:40:00</Продолжительность>

</ОсновнаяУслуга>

<ОсновнаяУслуга>

<UID>eb20edce-3ee0-11de-b0dd-0050bf5d92cb</UID>

<Продолжительность>0001-01-01T00:30:00</Продолжительность>

</ОсновнаяУслуга>

<ОсновнаяУслуга>

<UID>eb20edcf-3ee0-11de-b0dd-0050bf5d92cb</UID>

<Продолжительность>0001-01-01T01:00:00</Продолжительность>

</ОсновнаяУслуга>

</ОсновныеУслуги>

<СреднийРейтинг>3,7</СреднийРейтинг>

<КраткоеОписание/>

</Сотрудник>

<Сотрудник>

<UID xsi:type="xs:string">ac30e13a-3087-11dc-8594-005056c00008</UID>

<Наименование>Барышева Евгения Петровна</Наименование>

<Фамилия>Барышева</Фамилия>

<Имя>Евгения</Имя>

<Отчество>Петровна</Отчество>

<Специализация>Хирургия</Специализация>

<Организация>f679444a-22b7-11df-8618-002618dcef2c</Организация>

<ОсновныеУслуги>

<ОсновнаяУслуга>

<UID>eb20edcc-3ee0-11de-b0dd-0050bf5d92cb</UID>

<Продолжительность>0001-01-01T00:30:00</Продолжительность>

</ОсновнаяУслуга>

<ОсновнаяУслуга>

<UID>eb20edcd-3ee0-11de-b0dd-0050bf5d92cb</UID>

<Продолжительность>0001-01-01T01:00:00</Продолжительность>

</ОсновнаяУслуга>

</ОсновныеУслуги>

<СреднийРейтинг>4,0</СреднийРейтинг>

<КраткоеОписание>Офтальмолог, к-т мед. наук</КраткоеОписание>

</Сотрудник>

<Сотрудник>

<UID xsi:type="xs:string">6cf96534-3870-11e2-87ba-002618dcef2c</UID>

<Наименование>Ковалёва Ирина Михайловна</Наименование>

<Фамилия>Ковалёва</Фамилия>

<Имя>Ирина</Имя>

<Отчество>Михайловна</Отчество>

<Специализация>Педиатрия</Специализация>

<Организация>f679444a-22b7-11df-8618-002618dcef2c</Организация>

<ОсновныеУслуги/>

<Фото>

NWztpqOb5QSYWU9C49YD0MGU/G6/eQLEXn2nYulyJ9r+GZDIigVwnDT5UBqP/Rma

4ZgqQ8awccUwqpuxlDKUDByLRVJqloCJYePGUH2pbgwcP+bp8NxkSh3+D8F+KcVJ

uMygAAAAAElFTkSuQmCC</Фото>

<СреднийРейтинг>3,5</СреднийРейтинг>

<КраткоеОписание>Офтальмолог\r\n</КраткоеОписание>

</Сотрудник>

</Сотрудники>]]></m:return>

</m:GetListEmployeesResponse>

</soap:Body>

</soap:Envelope>

## GetListClinic (список филиалов)

**GetListClinic ()**.

Описание: Возвращает список клиник с их уникальными идентификаторами.

### Пример запроса:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ru="ru.umc">

<soap:Header/>

<soap:Body>

<ru:GetListClinic/>

</soap:Body>

</soap:Envelope>

### Пример ответа:

<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope">

<soap:Body>

<m:GetListClinicResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><![CDATA[<?xml version="1.0"?>

<СписокКлиник xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Клиника>

<Наименование>Второй центр</Наименование>

<УИД>4c68deb4-22c3-11df-8618-002618dcef2c</УИД>

</Клиника>

<Клиника>

<Наименование>Третий центр</Наименование>

<УИД>66abf7b4-2ff9-11df-8625-002618dcef2c</УИД>

</Клиника>

<Клиника>

<Наименование>Центральная клиника</Наименование>

<УИД>f679444a-22b7-11df-8618-002618dcef2c</УИД>

</Клиника>

</СписокКлиник>]]></m:return>

</m:GetListClinicResponse>

</soap:Body>

</soap:Envelope>

## GetNomenclatureAndPrices (прайс-лист)

**GetNomenclatureAndPrices** (GUID[string], Params [string]).

**GUID** – уникальный идентификатор клиники.

Params – не используется в дальнейшем.

Описание: Получает список номенклатуры, соответствующий отбору, а также основных услуг сотрудников и цен на них для выбранного филиала по выбранному прейскуранту.

Внимание, для работы данного пункта необходимо создать настройку обмена с сайтом на необходимый филиал и указать прайс! (Вкладка «Администрирование» – «Настройки обмена с сайтом»).

Возможные ошибки:

1. Ошибка при получении уникального идентификатора на основе GUID;
2. Ошибка при выполнении поиска клиники по уникальному идентификатору;
3. Не удалось получить настройку обмена (приходит ответ аналогичный неудачной записи документа Заявка).

### Пример запроса:

<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">

<Body>

<GetNomenclatureAndPrices xmlns="ru.umc">

<Clinic>4c68deb4-22c3-11df-8618-002618dcef2c</Clinic>

<Params>

<!-- Optional -->

<Property xmlns="http://v8.1c.ru/8.1/data/core">

<Value></Value>

</Property>

</Params>

</GetNomenclatureAndPrices>

</Body>

</Envelope>

### Пример ответа на запрос:

<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">

<soap:Body>

<m:GetNomenclatureAndPricesResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance

<Каталоги xmlns="S2" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Каталог>

<UID xsi:type="xs:string">b468afaa-f720-11e5-8273-40167e631f2e</UID>

<Наименование>Прочие услуги</Наименование>

<Артикул/>

<БазоваяЕдиницаИзмерения/>

<Цена>0</Цена>

<Продолжительность>0001-01-01T00:15:00</Продолжительность>

<Вид/>

<Родитель>00000000-0000-0000-0000-000000000000</Родитель>

<ЭтоПапка>true</ЭтоПапка>

</Каталог>

<Каталог>

<UID xsi:type="xs:string">b468afac-f720-11e5-8273-40167e631f2e</UID>

<Наименование>Пребывание в стационаре, сутки, обычная палата</Наименование>

<Артикул/>

<БазоваяЕдиницаИзмерения/>

<Цена>890</Цена>

<Продолжительность>0001-01-01T00:15:00</Продолжительность>

<Вид>Услуга</Вид>

<Родитель>b468afaa-f720-11e5-8273-40167e631f2e</Родитель>

<ЭтоПапка>false</ЭтоПапка>

</Каталог>

<Каталог>

<UID xsi:type="xs:string">b468afad-f720-11e5-8273-40167e631f2e</UID>

<Наименование>Пребывание в стационаре, сутки, VIP-палата</Наименование>

<Артикул/>

<БазоваяЕдиницаИзмерения/>

<Цена>1500</Цена>

<Продолжительность>0001-01-01T00:15:00</Продолжительность>

<Вид>Услуга</Вид>

<Родитель>b468afaa-f720-11e5-8273-40167e631f2e</Родитель>

<ЭтоПапка>false</ЭтоПапка>

</Каталог>

<Каталог>

<UID xsi:type="xs:string">a0230571-3ef7-11de-8086-001485c0d477</UID>

<Наименование>Гель для массажа</Наименование>

<Артикул>101-55</Артикул>

<БазоваяЕдиницаИзмерения>мл</БазоваяЕдиницаИзмерения>

<Цена>100</Цена>

<Продолжительность>0001-01-01T00:15:00</Продолжительность>

<Вид>Материал</Вид>

<Родитель>00000000-0000-0000-0000-000000000000</Родитель>

<ЭтоПапка>false</ЭтоПапка>

</Каталог>

</Каталоги></m:return>

</m:GetNomenclatureAndPricesResponse>

</soap:Body>

</soap:Envelope>

### Пример ответа на неудачный запрос:

<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">

<soap:Body>

<m:GetNomenclatureAndPricesResponse xmlns:m="ru.umc">

<m:return xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance<?xml version="1.0"?>

<ОтветНаЗаписьССайта xmlns="S1" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Результат>false</Результат>

<ОписаниеОшибки/>

</ОтветНаЗаписьССайта></m:return>

</m:GetNomenclatureAndPricesResponse>

</soap:Body>

</soap:Envelope>

# FTP

## Выгрузка номенклатуры и цен

Имя файла на FTP сервере: «Price.xml».

Содержит:

1. Уникальный идентификатор номенклатуры;
2. Наименование номенклатуры;
3. Уникальный идентификатор базовой единицы измерения;
4. Артикул;
5. Цену.

### Пример содержания:

<?xml version="1.0" encoding="UTF-8"?>

<Каталоги xmlns="S2" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

<Каталог>

<UID xsi:type="xs:string">a0230570-3ef7-11de-8086-001485c0d477</UID>

<Наименование>Массаж век</Наименование>

<Артикул/>

<БазоваяЕдиницаИзмерения/>

<Цена>160</Цена>

<Продолжительность>0001-01-01T00:30:00</Продолжительность>

<Вид>Услуга</Вид>

<Родитель>85812f75-1cc9-11dc-b7bd-000461ac6871</Родитель>

<ЭтоПапка>false</ЭтоПапка>

</Каталог>

<Каталог>

<UID xsi:type="xs:string">22d1b484-b34b-11de-8171-001583078ee5</UID>

<Наименование>Подбор очков (простая сферическая коррекция)</Наименование>

<Артикул/>

<БазоваяЕдиницаИзмерения>мин</БазоваяЕдиницаИзмерения>

<Цена>0</Цена>

<Продолжительность>0001-01-01T00:30:00</Продолжительность>

<Вид>Услуга</Вид>

<Родитель>85812f75-1cc9-11dc-b7bd-000461ac6871</Родитель>

<ЭтоПапка>false</ЭтоПапка>

</Каталог>

</Каталоги>

## Чтение листов ожидания

Файлы на сервере должны находиться в папке (указанной в настройках обмена с сайтом) и иметь расширение .xml. Так же должен содержать:

1. Дата и время записи в формате dateTime;
2. ФИО клиента;
3. Дата рождения клиента;
4. Пол (Определение значения идет по первой букве, «М» или «Ж», в любом регистре);
5. Описание;
6. Уникальный идентификатор клиники.

### Пример содержания:

<ЛистыОжидания xmlns="S2 " xmlns:xs="<http://www.w3.org/2001/XMLSchema>" xmlns:xsi="<http://www.w3.org/2001/XMLSchema-instance>">

<ЛистОжидания>

<ДатаВремяЗаписи>2012-07-07T15:00:00</ДатаВремяЗаписи>

<КлиентФамилия>Иванов</КлиентФамилия>

<КлиентИмя>Иван</КлиентИмя>

<КлиентОтчество>Иванович</КлиентОтчество>

<КлиентДатаРождения>1981-09-12T00:00:00</КлиентДатаРождения>

<КлиентПол>М</КлиентПол>

<Описание>Загружено с ВЕБ-сайта клиники. Специализация: офтальмолог Желаемое время: 14:00 Клиент: Иванов Иван, тел. 89876543210</Описание>

<Филиал>f679444a-22b7-11df-8618-002618dcef2c</Филиал>

</ЛистОжидания>

<ЛистОжидания>

<КлиентФамилия/>

<КлиентИмя/>

<КлиентОтчество/>

<КлиентПол/>

<Описание> Загружено с ВЕБ-сайта клиники. Специализация: офтальмолог
Желаемое время: 14:00 Клиент: Пупкин Василий, e-mail Vasya.pupkin@gmail.com</Описание>

<Филиал>f679444a-22b7-11df-8618-002618dcef2c</Филиал>

</ЛистОжидания>

<ЛистОжидания>

<ДатаВремяЗаписи>2013-02-01T15:00:00</ДатаВремяЗаписи>

<КлиентФамилия>Петрова</КлиентФамилия>

<КлиентИмя>Мария</КлиентИмя>

<КлиентОтчество>Сидоровна</КлиентОтчество>

<КлиентДатаРождения>1994-09-12T00:00:00</КлиентДатаРождения>

<КлиентПол>Ж</КлиентПол>

<Описание>Загружено с ВЕБ-сайта клиники. Желаемый врач: Васильева. Желаемое время: 15:00 Клиент: Петрова Мария, тел. 89876543211 </Описание>

<Филиал>f679444a-22b7-11df-8618-002618dcef2c</Филиал>

</ЛистОжидания>

</ЛистыОжидания>

# HTTP-сервисы дополнительные

**Корневой URL (ROOT\_URL) по умолчанию:** crm

## CreateLead (Создание лида)

**Стандартный шаблон URL (PATTERN\_URL):** /createlead

Описание:

Создаёт лист ожидания и заполняет его данными, полученными из тела запроса. При возникновении ошибки возвращает текст ошибки в теле ответа.

Все параметры являются необязательными и определяют степень заполненности создаваемого документа.

### Параметры в теле запроса:

|  |  |  |
| --- | --- | --- |
| **Наименование** | **Тип значения** | **Описание** |
| note | string | Примечание |
| client | string | Уникальный идентификатор клиента или его ФИО |
| birthday | dateTime | Дата рождения клиента |
| phone | string | Номер телефона клиента |
| employee | string | 1. УИД сотрудника 2. Наименование сотрудника |
| date | dateTime | Дата и время записи |
| special | string | 1. УИД специализации сотрудника 2. Наименование специализации |
| service | array | Массив состоит из   1. УИД номенклатур 2. Наименований номенклатур |
| branch\_uid | string | УИД филиала |
| utm\_source | string | Источник информации |
| utm\_medium | string | Тип рекламы |
| utm\_compaign | string | Рекламная компания |
| utm\_term | string | Ключевое слово рекламной компании |
| utm\_content | string | Содержание объявления |

### Структура синтаксиса:

#### JSON

{

"note": "Примечание",

"client": "УИД/Наименование клиента",

"birthday": "1970-01-01T00:00:00",

"phone": "8-999-999-99-99",

"employee": "УИД/Наименование сотрудника",

"date": "2020-02-02T12:30:00",

"special": "УИД/Наименование специализации сотрудника",

"service": [

"УИД/Наименование номенклатуры работы 1",

"УИД/Наименование номенклатуры работы 2",

"УИД/Наименование номенклатуры работы 3"

],

"branch\_uid": "УИД филиала",

"utm\_source": "Источник информации",

"utm\_medium": "Тип компании",

"utm\_compaign": "Рекламная компания",

"utm\_term": "Ключевое слово рекламной компании",

"utm\_content": "Содержание объявления"

}

#### XML

<Structure

xmlns="http://v8.1c.ru/8.1/data/core"

xmlns:xs="http://www.w3.org/2001/XMLSchema"

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="Structure">

<Property name="note">

<Value xsi:type="xs:string">Примечание</Value>

</Property>

<Property name="client">

<Value xsi:type="xs:string">УИД/Наименование клиента</Value>

</Property>

<Property name="birthday">

<Value xsi:type="xs:dateTime">1970-01-01T00:00:00</Value>

</Property>

<Property name="phone">

<Value xsi:type="xs:string">8-999-999-99-99</Value>

</Property>

<Property name="employee">

<Value xsi:type="xs:string">УИД/Наименование сотрудника</Value>

</Property>

<Property name="date">

<Value xsi:type="xs:dateTime">2020-02-02T12:30:00</Value>

</Property>

<Property name="special">

<Value xsi:type="xs:string">УИД/Наименование специализации сотрудника</Value>

</Property>

<Property name="service">

<Value xsi:type="Array">

<Value xsi:type="xs:string">УИД/Наименование номенклатуры 1</Value>

<Value xsi:type="xs:string">УИД/Наименование номенклатуры 2</Value>

<Value xsi:type="xs:string">УИД/Наименование номенклатуры 3</Value>

</Value>

</Property>

<Property name="branch\_uid">

<Value xsi:type="xs:string">УИД филиала </Value>

</Property>

<Property name="utm\_source">

<Value xsi:type="xs:string">Источник информации</Value>

</Property>

<Property name="utm\_medium">

<Value xsi:type="xs:string">Тип компании</Value>

</Property>

<Property name="utm\_compaign">

<Value xsi:type="xs:string">Рекламная компания</Value>

</Property>

<Property name="utm\_term">

<Value xsi:type="xs:string">Ключевое слово рекламной компании</Value>

</Property>

<Property name="utm\_content">

<Value xsi:type="xs:string">Содержание объявления</Value>

</Property>

</Structure>

#### x-www-form-urlencoded

note=Примечание&client=УИД/Наименование клиента&birthday=01.01.1970 0:00:00&phone=8-999-999-99-99&employee=УИД/Наименование сотрудника&date=02.02.2020 12:30:00&special=УИД/Наименование специализации&service[0]=УИД/Наименование номенклатуры работы 1&service[1]=УИД/Наименование номенклатуры работы 2&service[2]=УИД/Наименование номенклатуры работы 3&branch\_uid=УИД филиала &utm\_source=Источник информации&utm\_medium=Тип компании&utm\_compaign=Рекламная компания&utm\_term=Ключевое слово рекламной компании&utm\_content=Содержание объявления

### Пример:

JSON

{

"note": "Примечание\nМногострочное",

"client": "Абдулов Юрий Владимирович",

"birthday": "1976-06-06T00:00:00",

"phone": "8-963-083-62-75",

"employee": "ac30e13a-3087-11dc-8594-005056c00008",

"data": "2020-08-29T17:37:28",

"special": "785d8a6e-5c72-11dd-8423-005056c00008",

"service": [

"eb20edce-3ee0-11de-b0dd-0050bf5d92cb",

"eb20edcf-3ee0-11de-b0dd-0050bf5d92cb",

"a0230570-3ef7-11de-8086-001485c0d477"

],

"branch\_uid": "f679444a-22b7-11df-8618-002618dcef2c",

"utm\_medium": "cpm",

"utm\_source": "clinic\_site",

"utm\_compaign": "company\_1",

"utm\_term": "Ключевое слово рекламной компании",

"utm\_content": "Содержание объявления"

}
